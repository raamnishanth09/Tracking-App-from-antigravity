import{c as Y,n as ee,r as u,j as e,P as I,d as L,o as te,p as K,q as ge,t as be,v as ve,g as je,i as Ce,B as w,a as Ne,U as ye,A as U,b as z,I as F,u as P,s as N}from"./index-C9PopRjW.js";import{C as Q,a as ke,b as _e,c as G}from"./card-Dr7gnhHP.js";import{T as we}from"./textarea-ltqZxKs9.js";import{B as Pe}from"./badge-DvKv-gUx.js";import{u as De,S as Se,a as Ee,b as Ie,c as Me,d as A}from"./select-N4MQfODT.js";import{D as Re,a as Ae,b as qe,c as Te,d as Be}from"./dialog-BWr1A6GL.js";import{C as Fe}from"./check-B8NMrcNy.js";import{S as Le}from"./scroll-area-eph62MYP.js";import{u as X}from"./useQuery-Cs1p8e55.js";import{P as $e}from"./plus-DZdoEr8Y.js";import{P as Oe,T as Ve}from"./trash-2-DRgJ7cG6.js";import{f as Z}from"./format-BuON0pZi.js";import"./index-BjHVK9V2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=Y("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Y("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);var $="Progress",O=100,[Ue,ht]=ee($),[ze,Qe]=Ue($),se=u.forwardRef((s,a)=>{const{__scopeProgress:c,value:i=null,max:n,getValueLabel:o=Ge,...p}=s;(n||n===0)&&!J(n)&&console.error(Xe(`${n}`,"Progress"));const m=J(n)?n:O;i!==null&&!W(i,m)&&console.error(Ze(`${i}`,"Progress"));const l=W(i,m)?i:null,j=q(l)?o(l,m):void 0;return e.jsx(ze,{scope:c,value:l,max:m,children:e.jsx(I.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":q(l)?l:void 0,"aria-valuetext":j,role:"progressbar","data-state":ne(l,m),"data-value":l??void 0,"data-max":m,...p,ref:a})})});se.displayName=$;var ae="ProgressIndicator",re=u.forwardRef((s,a)=>{const{__scopeProgress:c,...i}=s,n=Qe(ae,c);return e.jsx(I.div,{"data-state":ne(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...i,ref:a})});re.displayName=ae;function Ge(s,a){return`${Math.round(s/a*100)}%`}function ne(s,a){return s==null?"indeterminate":s===a?"complete":"loading"}function q(s){return typeof s=="number"}function J(s){return q(s)&&!isNaN(s)&&s>0}function W(s,a){return q(s)&&!isNaN(s)&&s<=a&&s>=0}function Xe(s,a){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${O}\`.`}function Ze(s,a){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${O} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var oe=se,Je=re;const ie=u.forwardRef(({className:s,value:a,...c},i)=>e.jsx(oe,{ref:i,className:L("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...c,children:e.jsx(Je,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));ie.displayName=oe.displayName;var T="Checkbox",[We,pt]=ee(T),[Ye,V]=We(T);function et(s){const{__scopeCheckbox:a,checked:c,children:i,defaultChecked:n,disabled:o,form:p,name:m,onCheckedChange:l,required:j,value:g="on",internal_do_not_use_render:x}=s,[r,b]=ve({prop:c,defaultProp:n??!1,onChange:l,caller:T}),[C,y]=u.useState(null),[_,f]=u.useState(null),h=u.useRef(!1),D=C?!!p||!!C.closest("form"):!0,S={checked:r,disabled:o,setChecked:b,control:C,setControl:y,name:m,form:p,value:g,hasConsumerStoppedPropagationRef:h,required:j,defaultChecked:k(n)?!1:n,isFormControl:D,bubbleInput:_,setBubbleInput:f};return e.jsx(Ye,{scope:a,...S,children:tt(x)?x(S):i})}var le="CheckboxTrigger",de=u.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:c,...i},n)=>{const{control:o,value:p,disabled:m,checked:l,required:j,setControl:g,setChecked:x,hasConsumerStoppedPropagationRef:r,isFormControl:b,bubbleInput:C}=V(le,s),y=te(n,g),_=u.useRef(l);return u.useEffect(()=>{const f=o==null?void 0:o.form;if(f){const h=()=>x(_.current);return f.addEventListener("reset",h),()=>f.removeEventListener("reset",h)}},[o,x]),e.jsx(I.button,{type:"button",role:"checkbox","aria-checked":k(l)?"mixed":l,"aria-required":j,"data-state":xe(l),"data-disabled":m?"":void 0,disabled:m,value:p,...i,ref:y,onKeyDown:K(a,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:K(c,f=>{x(h=>k(h)?!0:!h),C&&b&&(r.current=f.isPropagationStopped(),r.current||f.stopPropagation())})})});de.displayName=le;var H=u.forwardRef((s,a)=>{const{__scopeCheckbox:c,name:i,checked:n,defaultChecked:o,required:p,disabled:m,value:l,onCheckedChange:j,form:g,...x}=s;return e.jsx(et,{__scopeCheckbox:c,checked:n,defaultChecked:o,disabled:m,required:p,onCheckedChange:j,name:i,form:g,value:l,internal_do_not_use_render:({isFormControl:r})=>e.jsxs(e.Fragment,{children:[e.jsx(de,{...x,ref:a,__scopeCheckbox:c}),r&&e.jsx(fe,{__scopeCheckbox:c})]})})});H.displayName=T;var ce="CheckboxIndicator",ue=u.forwardRef((s,a)=>{const{__scopeCheckbox:c,forceMount:i,...n}=s,o=V(ce,c);return e.jsx(ge,{present:i||k(o.checked)||o.checked===!0,children:e.jsx(I.span,{"data-state":xe(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:a,style:{pointerEvents:"none",...s.style}})})});ue.displayName=ce;var me="CheckboxBubbleInput",fe=u.forwardRef(({__scopeCheckbox:s,...a},c)=>{const{control:i,hasConsumerStoppedPropagationRef:n,checked:o,defaultChecked:p,required:m,disabled:l,name:j,value:g,form:x,bubbleInput:r,setBubbleInput:b}=V(me,s),C=te(c,b),y=De(o),_=be(i);u.useEffect(()=>{const h=r;if(!h)return;const D=window.HTMLInputElement.prototype,M=Object.getOwnPropertyDescriptor(D,"checked").set,B=!n.current;if(y!==o&&M){const t=new Event("click",{bubbles:B});h.indeterminate=k(o),M.call(h,k(o)?!1:o),h.dispatchEvent(t)}},[r,y,o,n]);const f=u.useRef(k(o)?!1:o);return e.jsx(I.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??f.current,required:m,disabled:l,name:j,value:g,form:x,...a,tabIndex:-1,ref:C,style:{...a.style,..._,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});fe.displayName=me;function tt(s){return typeof s=="function"}function k(s){return s==="indeterminate"}function xe(s){return k(s)?"indeterminate":s?"checked":"unchecked"}const he=u.forwardRef(({className:s,...a},c)=>e.jsx(H,{ref:c,className:L("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(ue,{className:L("flex items-center justify-center text-current"),children:e.jsx(Fe,{className:"h-4 w-4"})})}));he.displayName=H.displayName;const gt=()=>{const{user:s}=je(),a=Ce(),[c,i]=u.useState(!1),[n,o]=u.useState(!1),[p,m]=u.useState(!1),[l,j]=u.useState(null),[g,x]=u.useState([]),[r,b]=u.useState({name:"",description:"",startDate:"",endDate:"",status:"active"}),{data:C=[]}=X({queryKey:["projects"],queryFn:async()=>{const{data:t}=await N.from("projects").select("*").order("created_at",{ascending:!1});if(!t)return[];const{data:d}=await N.from("project_members").select("project_id, user_id"),{data:v}=await N.from("profiles").select("user_id, full_name"),pe=new Map((v==null?void 0:v.map(E=>[E.user_id,E.full_name]))||[]);return t.map(E=>({...E,members:(d||[]).filter(R=>R.project_id===E.id).map(R=>({user_id:R.user_id,full_name:pe.get(R.user_id)||"Unknown"}))}))}}),{data:y=[]}=X({queryKey:["all-members"],queryFn:async()=>{const{data:t}=await N.from("profiles").select("user_id, full_name, designation").order("full_name");return t||[]}}),_=()=>{o(!1),j(null),b({name:"",description:"",startDate:"",endDate:"",status:"active"}),x([]),i(!0)},f=t=>{var d;o(!0),j(t),b({name:t.name,description:t.description||"",startDate:t.start_date||"",endDate:t.end_date||"",status:t.status}),x(((d=t.members)==null?void 0:d.map(v=>v.user_id))||[]),i(!0)},h=async()=>{if(!(s!=null&&s.id)||!r.name.trim()){P.error("Please enter a project name");return}m(!0);try{if(n&&l){const{error:t}=await N.from("projects").update({name:r.name.trim(),description:r.description.trim()||null,start_date:r.startDate||null,end_date:r.endDate||null,status:r.status}).eq("id",l.id);if(t)throw t;await N.from("project_members").delete().eq("project_id",l.id),g.length>0&&await N.from("project_members").insert(g.map(d=>({project_id:l.id,user_id:d}))),P.success("Project updated!")}else{const{data:t,error:d}=await N.from("projects").insert({name:r.name.trim(),description:r.description.trim()||null,start_date:r.startDate||null,end_date:r.endDate||null,status:r.status,created_by:s.id}).select("id").single();if(d)throw d;g.length>0&&t&&await N.from("project_members").insert(g.map(v=>({project_id:t.id,user_id:v}))),P.success("Project created!")}i(!1),a.invalidateQueries({queryKey:["projects"]})}catch(t){P.error("Failed to save project"),console.error(t)}finally{m(!1)}},D=async t=>{if(!confirm("Are you sure you want to delete this project?"))return;const{error:d}=await N.from("projects").delete().eq("id",t);if(d){P.error("Failed to delete project");return}P.success("Project deleted"),a.invalidateQueries({queryKey:["projects"]})},S=async(t,d)=>{const{error:v}=await N.from("projects").update({progress:d}).eq("id",t);v||a.invalidateQueries({queryKey:["projects"]})},M=t=>{switch(t){case"active":return"bg-blue-100 text-blue-700";case"completed":return"bg-green-100 text-green-700";case"on_hold":return"bg-yellow-100 text-yellow-700";case"cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}},B=t=>{x(d=>d.includes(t)?d.filter(v=>v!==t):[...d,t])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Projects"}),e.jsxs("p",{className:"text-muted-foreground",children:[C.length," projects"]})]}),e.jsxs(w,{onClick:_,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"New Project"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(t=>e.jsxs(Q,{className:"card-elevated hover:shadow-lg transition-shadow",children:[e.jsx(ke,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(_e,{className:"text-lg truncate flex-1",children:t.name}),e.jsx(Pe,{className:M(t.status),children:t.status})]})}),e.jsxs(G,{className:"space-y-4",children:[t.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.description}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[t.progress,"%"]})]}),e.jsx(ie,{value:t.progress,className:"h-2"})]}),(t.start_date||t.end_date)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ne,{className:"w-4 h-4"}),t.start_date&&Z(new Date(t.start_date),"MMM d"),t.start_date&&t.end_date&&" - ",t.end_date&&Z(new Date(t.end_date),"MMM d, yyyy")]}),t.members&&t.members.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{className:"flex -space-x-2",children:[t.members.slice(0,4).map(d=>e.jsx(U,{className:"w-7 h-7 border-2 border-background",children:e.jsx(z,{className:"text-xs gradient-bg text-primary-foreground",children:d.full_name.split(" ").map(v=>v[0]).join("")})},d.user_id)),t.members.length>4&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-muted flex items-center justify-center text-xs border-2 border-background",children:["+",t.members.length-4]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>f(t),className:"flex-1",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>S(t.id,Math.min(100,t.progress+10)),children:e.jsx(He,{className:"w-3 h-3"})}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>D(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(Ve,{className:"w-3 h-3"})})]})]})]},t.id))}),C.length===0&&e.jsx(Q,{children:e.jsxs(G,{className:"py-12 text-center",children:[e.jsx(Ke,{className:"w-12 h-12 mx-auto text-muted-foreground/30 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No projects yet. Create your first project!"})]})}),e.jsx(Re,{open:c,onOpenChange:i,children:e.jsxs(Ae,{className:"max-w-lg",children:[e.jsx(qe,{children:e.jsx(Te,{children:n?"Edit Project":"New Project"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Project Name *"}),e.jsx(F,{value:r.name,onChange:t=>b({...r,name:t.target.value}),placeholder:"Enter project name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Description"}),e.jsx(we,{value:r.description,onChange:t=>b({...r,description:t.target.value}),placeholder:"Project description",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Start Date"}),e.jsx(F,{type:"date",value:r.startDate,onChange:t=>b({...r,startDate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"End Date"}),e.jsx(F,{type:"date",value:r.endDate,onChange:t=>b({...r,endDate:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Status"}),e.jsxs(Se,{value:r.status,onValueChange:t=>b({...r,status:t}),children:[e.jsx(Ee,{children:e.jsx(Ie,{})}),e.jsxs(Me,{children:[e.jsx(A,{value:"active",children:"Active"}),e.jsx(A,{value:"on_hold",children:"On Hold"}),e.jsx(A,{value:"completed",children:"Completed"}),e.jsx(A,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Assign Members"}),e.jsx(Le,{className:"h-40 border rounded-lg p-2",children:e.jsx("div",{className:"space-y-2",children:y.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded hover:bg-muted cursor-pointer",onClick:()=>B(t.user_id),children:[e.jsx(he,{checked:g.includes(t.user_id)}),e.jsx(U,{className:"w-8 h-8",children:e.jsx(z,{className:"text-xs gradient-bg text-primary-foreground",children:t.full_name.split(" ").map(d=>d[0]).join("")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:t.full_name}),t.designation&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.designation})]})]},t.user_id))})})]})]}),e.jsxs(Be,{children:[e.jsx(w,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(w,{onClick:h,disabled:p,children:p?"Saving...":n?"Update":"Create"})]})]})})]})};export{gt as default};
