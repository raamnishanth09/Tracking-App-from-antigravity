import{g as S,i as M,r as y,s as u,j as e,F as E,I as c,C as x,B as m,X as v,u as n}from"./index.js";import{C as g,a as k,b as N,d as F,c as b}from"./card.js";import{T as Q}from"./textarea.js";import{u as U}from"./useQuery.js";import{L as w,S as W}from"./save.js";import{P as A}from"./plus.js";import{f as h}from"./format.js";const X=()=>{const{user:r}=S(),d=M(),[p,f]=y.useState(!1),[t,l]=y.useState({title:"",description:"",startTime:"",endTime:"",links:[""]}),{data:j=[]}=U({queryKey:["today-work-updates",r==null?void 0:r.id],queryFn:async()=>{if(!(r!=null&&r.id))return[];const s=h(new Date,"yyyy-MM-dd"),{data:a}=await u.from("work_updates").select("*").eq("user_id",r.id).eq("date",s).order("created_at",{ascending:!1});return a||[]},enabled:!!(r!=null&&r.id)}),T=()=>{l({...t,links:[...t.links,""]})},C=s=>{const a=t.links.filter((i,o)=>o!==s);l({...t,links:a.length?a:[""]})},L=(s,a)=>{const i=[...t.links];i[s]=a,l({...t,links:i})},q=async s=>{if(s.preventDefault(),!(r!=null&&r.id))return;if(!t.title.trim()){n.error("Please enter a title for your work update");return}if(!t.startTime||!t.endTime){n.error("Please enter start and end times");return}f(!0);const a=h(new Date,"yyyy-MM-dd"),i=t.links.filter(D=>D.trim()),{error:o}=await u.from("work_updates").insert({user_id:r.id,title:t.title.trim(),description:t.description.trim()||null,date:a,start_time:t.startTime,end_time:t.endTime,links:i.length?i:null});if(f(!1),o){n.error("Failed to save work update"),console.error(o);return}n.success("Work update saved!"),l({title:"",description:"",startTime:"",endTime:"",links:[""]}),d.invalidateQueries({queryKey:["today-work-updates"]}),d.invalidateQueries({queryKey:["my-work-updates"]})},_=async s=>{const{error:a}=await u.from("work_updates").delete().eq("id",s);if(a){n.error("Failed to delete");return}n.success("Deleted!"),d.invalidateQueries({queryKey:["today-work-updates"]}),d.invalidateQueries({queryKey:["my-work-updates"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Work Updates"}),e.jsx("p",{className:"text-muted-foreground",children:"Log your daily work activities and progress"})]}),e.jsxs(g,{children:[e.jsxs(k,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-primary"}),"Add Work Update"]}),e.jsx(F,{children:h(new Date,"EEEE, MMMM d, yyyy")})]}),e.jsx(b,{children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Task Title *"}),e.jsx(c,{placeholder:"What did you work on?",value:t.title,onChange:s=>l({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Start Time *"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(c,{type:"time",value:t.startTime,onChange:s=>l({...t,startTime:s.target.value}),className:"pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"End Time *"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(c,{type:"time",value:t.endTime,onChange:s=>l({...t,endTime:s.target.value}),className:"pl-10",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Description"}),e.jsx(Q,{placeholder:"Describe what you accomplished, challenges faced, etc.",value:t.description,onChange:s=>l({...t,description:s.target.value}),rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Related Links"}),e.jsxs("div",{className:"space-y-2",children:[t.links.map((s,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(c,{type:"url",placeholder:"https://...",value:s,onChange:i=>L(a,i.target.value),className:"pl-10"})]}),t.links.length>1&&e.jsx(m,{type:"button",variant:"outline",size:"icon",onClick:()=>C(a),children:e.jsx(v,{className:"w-4 h-4"})})]},a)),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:T,className:"w-full",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Add Link"]})]})]}),e.jsxs(m,{type:"submit",className:"w-full",disabled:p,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),p?"Saving...":"Save Work Update"]})]})})]}),e.jsxs(g,{children:[e.jsx(k,{children:e.jsx(N,{children:"Today's Updates"})}),e.jsx(b,{children:j.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-6",children:"No updates logged today. Add your first update above!"}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsx("div",{className:"p-4 rounded-lg border bg-card hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-muted-foreground",children:[e.jsx(x,{className:"w-4 h-4"}),s.start_time," - ",s.end_time]}),s.description&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:s.description}),s.links&&s.links.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.links.map((a,i)=>e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),"Link ",i+1]},i))})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>_(s.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(v,{className:"w-4 h-4"})})]})},s.id))})})]})]})};export{X as default};
