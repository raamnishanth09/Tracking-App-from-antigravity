import{g as S,i as k,r as b,s as N,j as e,F as M,a as _,I as d,C as w,B as F,u as n}from"./index-CugQ5QCp.js";import{C as i,a as m,b as o,d as L,c}from"./card-BhFlIpAy.js";import{T as R}from"./textarea-BnDtZksS.js";import{S as P,a as H,b as q,c as B,d as x}from"./select-DRaFtV9a.js";import{B as D}from"./badge-Ba_C9fQM.js";import{u as I}from"./useQuery-kEhrXH_B.js";import{S as E}from"./send-GniDy-WR.js";import{f as l}from"./format-BuON0pZi.js";import"./index-DtFxQiqy.js";import"./check-VQELwqnM.js";const X=()=>{const{user:a}=S(),T=k(),[u,p]=b.useState(!1),[t,r]=b.useState({type:"full_day",startDate:"",endDate:"",startTime:"",endTime:"",reason:""}),{data:h=[]}=I({queryKey:["my-leave-requests",a==null?void 0:a.id],queryFn:async()=>{if(!(a!=null&&a.id))return[];const{data:s}=await N.from("leave_requests").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});return s||[]},enabled:!!(a!=null&&a.id)}),C=async s=>{if(s.preventDefault(),!(a!=null&&a.id))return;if(!t.startDate||!t.reason.trim()){n.error("Please fill in all required fields");return}if(t.type==="permission"&&(!t.startTime||!t.endTime)){n.error("Please specify time range for permission");return}p(!0);const{error:v}=await N.from("leave_requests").insert({user_id:a.id,type:t.type,start_date:t.startDate,end_date:t.type==="full_day"&&t.endDate?t.endDate:t.startDate,start_time:t.type==="permission"?t.startTime:null,end_time:t.type==="permission"?t.endTime:null,reason:t.reason.trim()});if(p(!1),v){n.error("Failed to submit request"),console.error(v);return}n.success("Leave request submitted!"),r({type:"full_day",startDate:"",endDate:"",startTime:"",endTime:"",reason:""}),T.invalidateQueries({queryKey:["my-leave-requests"]})},f=s=>{switch(s){case"approved":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400";case"rejected":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400";default:return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"}},y=s=>{switch(s){case"full_day":return"Full Day Leave";case"half_day":return"Half Day Leave";case"permission":return"Permission";default:return s}},j=h.filter(s=>s.status==="pending"),g=h.filter(s=>s.status!=="pending");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Leave & Permission"}),e.jsx("p",{className:"text-muted-foreground",children:"Apply for leave or request permission for time off"})]}),e.jsxs(i,{children:[e.jsxs(m,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-primary"}),"New Request"]}),e.jsx(L,{children:"Submit a new leave or permission request"})]}),e.jsx(c,{children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Request Type *"}),e.jsxs(P,{value:t.type,onValueChange:s=>r({...t,type:s}),children:[e.jsx(H,{children:e.jsx(q,{})}),e.jsxs(B,{children:[e.jsx(x,{value:"full_day",children:"Full Day Leave"}),e.jsx(x,{value:"half_day",children:"Half Day Leave"}),e.jsx(x,{value:"permission",children:"Permission (Hours)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:t.type==="permission"?"Date *":"Start Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{type:"date",value:t.startDate,onChange:s=>r({...t,startDate:s.target.value}),className:"pl-10",required:!0})]})]}),t.type==="full_day"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"End Date (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{type:"date",value:t.endDate,onChange:s=>r({...t,endDate:s.target.value}),className:"pl-10",min:t.startDate})]})]})]}),t.type==="permission"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"From Time *"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{type:"time",value:t.startTime,onChange:s=>r({...t,startTime:s.target.value}),className:"pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"To Time *"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{type:"time",value:t.endTime,onChange:s=>r({...t,endTime:s.target.value}),className:"pl-10",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Reason *"}),e.jsx(R,{placeholder:"Please provide the reason for your request...",value:t.reason,onChange:s=>r({...t,reason:s.target.value}),rows:3,required:!0})]}),e.jsxs(F,{type:"submit",className:"w-full",disabled:u,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),u?"Submitting...":"Submit Request"]})]})})]}),j.length>0&&e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-lg",children:"Pending Requests"})}),e.jsx(c,{className:"space-y-3",children:j.map(s=>e.jsx("div",{className:"p-4 rounded-lg border bg-yellow-50/50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(D,{className:f(s.status),children:s.status}),e.jsx("span",{className:"text-sm font-medium",children:y(s.type)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l(new Date(s.start_date),"MMM d, yyyy"),s.end_date&&s.end_date!==s.start_date&&e.jsxs(e.Fragment,{children:[" - ",l(new Date(s.end_date),"MMM d, yyyy")]}),s.start_time&&s.end_time&&e.jsxs(e.Fragment,{children:[" (",s.start_time," - ",s.end_time,")"]})]}),e.jsx("p",{className:"text-sm mt-2",children:s.reason})]})})},s.id))})]}),e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-lg",children:"Request History"})}),e.jsx(c,{children:g.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-6",children:"No processed requests yet"}):e.jsx("div",{className:"space-y-3",children:g.map(s=>e.jsx("div",{className:"p-4 rounded-lg border bg-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(D,{className:f(s.status),children:s.status}),e.jsx("span",{className:"text-sm font-medium",children:y(s.type)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l(new Date(s.start_date),"MMM d, yyyy"),s.end_date&&s.end_date!==s.start_date&&e.jsxs(e.Fragment,{children:[" - ",l(new Date(s.end_date),"MMM d, yyyy")]})]}),e.jsx("p",{className:"text-sm mt-1",children:s.reason}),s.review_notes&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 italic",children:["Note: ",s.review_notes]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:l(new Date(s.created_at),"MMM d")})]})},s.id))})})]})]})};export{X as default};
