import{c as q,g as B,i as I,r as i,j as e,A as Q,b as U,a as K,C as z,B as x,X as E,s as j,u as d}from"./index-CugQ5QCp.js";import{C as b,c as C}from"./card-BhFlIpAy.js";import{B as R}from"./badge-Ba_C9fQM.js";import{T as H}from"./textarea-BnDtZksS.js";import{D as V,a as O,b as X,c as G,d as J}from"./dialog-Bq7DMun_.js";import{S as W,a as Y,b as Z,c as $,d as h}from"./select-DRaFtV9a.js";import{u as ee}from"./useQuery-kEhrXH_B.js";import{C as se}from"./check-VQELwqnM.js";import{f as S}from"./format-BuON0pZi.js";import"./index-DtFxQiqy.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=q("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),pe=()=>{const{user:t}=B(),v=I(),[l,D]=i.useState("pending"),[A,c]=i.useState(!1),[y,N]=i.useState(null),[o,w]=i.useState(""),[f,m]=i.useState(!1),{data:g=[]}=ee({queryKey:["all-leave-requests",l],queryFn:async()=>{let s=j.from("leave_requests").select("*").order("created_at",{ascending:!1});l!=="all"&&(s=s.eq("status",l));const{data:r}=await s;if(!r)return[];const u=[...new Set(r.map(a=>a.user_id))],{data:n}=await j.from("profiles").select("user_id, full_name, designation, department").in("user_id",u),p=new Map((n==null?void 0:n.map(a=>[a.user_id,a]))||[]);return r.map(a=>({...a,profile:p.get(a.user_id)}))}}),F=async s=>{if(!(t!=null&&t.id))return;m(!0);const{error:r}=await j.from("leave_requests").update({status:"approved",reviewed_by:t.id}).eq("id",s.id);if(m(!1),r){d.error("Failed to approve request");return}d.success("Request approved!"),v.invalidateQueries({queryKey:["all-leave-requests"]})},k=s=>{N(s),w(""),c(!0)},M=async()=>{if(!(t!=null&&t.id)||!y||!o.trim()){d.error("Please provide a rejection reason");return}m(!0);const{error:s}=await j.from("leave_requests").update({status:"rejected",reviewed_by:t.id,review_notes:o.trim()}).eq("id",y.id);if(m(!1),s){d.error("Failed to reject request");return}d.success("Request rejected"),c(!1),N(null),v.invalidateQueries({queryKey:["all-leave-requests"]})},T=s=>{switch(s){case"full_day":return"Full Day Leave";case"half_day":return"Half Day Leave";case"permission":return"Permission";default:return s}},L=s=>{switch(s){case"approved":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";default:return"bg-yellow-100 text-yellow-700"}},_=g.filter(s=>s.status==="pending").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Leave Approvals"}),e.jsxs("p",{className:"text-muted-foreground",children:[_," pending request",_!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(W,{value:l,onValueChange:s=>D(s),children:[e.jsx(Y,{className:"w-40",children:e.jsx(Z,{})}),e.jsxs($,{children:[e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"approved",children:"Approved"}),e.jsx(h,{value:"rejected",children:"Rejected"}),e.jsx(h,{value:"all",children:"All"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:g.length===0?e.jsx(b,{children:e.jsx(C,{className:"py-8",children:e.jsxs("p",{className:"text-muted-foreground text-center",children:["No ",l==="all"?"":l," requests found"]})})}):g.map(s=>{var r,u,n,p,a;return e.jsx(b,{className:"card-elevated",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Q,{className:"w-12 h-12",children:e.jsx(U,{className:"gradient-bg text-primary-foreground",children:((u=(r=s.profile)==null?void 0:r.full_name)==null?void 0:u.split(" ").map(P=>P[0]).join("").toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:((n=s.profile)==null?void 0:n.full_name)||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((p=s.profile)==null?void 0:p.designation)||((a=s.profile)==null?void 0:a.department)||"Team Member"})]}),e.jsx(R,{className:L(s.status),children:s.status})]}),e.jsxs("div",{className:"mt-3 p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{variant:"outline",children:T(s.type)}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),S(new Date(s.start_date),"MMM d, yyyy"),s.end_date&&s.end_date!==s.start_date&&e.jsxs(e.Fragment,{children:[" - ",S(new Date(s.end_date),"MMM d, yyyy")]})]}),s.start_time&&s.end_time&&e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),s.start_time," - ",s.end_time]})]}),e.jsx("p",{className:"text-sm",children:s.reason}),s.review_notes&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 italic",children:["Note: ",s.review_notes]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(x,{size:"sm",onClick:()=>F(s),disabled:f,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(x,{size:"sm",variant:"destructive",onClick:()=>k(s),disabled:f,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]})]})})},s.id)})}),e.jsx(V,{open:A,onOpenChange:c,children:e.jsxs(O,{children:[e.jsx(X,{children:e.jsx(G,{children:"Reject Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please provide a reason for rejecting this request. This will be visible to the employee."}),e.jsx(H,{placeholder:"Reason for rejection...",value:o,onChange:s=>w(s.target.value),rows:3})]}),e.jsxs(J,{children:[e.jsx(x,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{variant:"destructive",onClick:M,disabled:!o.trim()||f,children:"Reject Request"})]})]})})]})};export{pe as default};
